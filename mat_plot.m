clear all
close all

%% Without QP

h1_estimated = [7.96, 7.928974937158787, 7.868129280531116, 7.655373201494912, 7.369917002630942, 6.911685329961395, 6.411385565542018, 5.432061249075838, 4.343388281856221, 4.227811789853362, 3.958467797899236, 3.964811720057444, 4.932077981526811, 6.143192692550748, 7.075105178116824, 7.731774795733765, 8.017317873522279, 7.912990894256381, 7.601602479928328, 7.256601845720597, 7.034551031409542, 6.9629220230278595, 7.198093631605397, 7.6887551022456755, 7.899615454959054, 7.880227962005977, 7.667125268490539, 7.156652115227087, 6.430127146659789, 5.950845654328981];

h2_estimated = [0.9500000000000001, 0.9810250628412128, 1.0418707194688837, 1.254626798505088, 1.540082997369058, 1.9983146700386045, 2.4986144344579824, 3.477938750924162, 4.566611718143779, 4.682188210146638, 4.951532202100764, 4.945188279942556, 3.9779220184731887, 2.7668073074492514, 1.8348948218831755, 1.178225204266235, 0.8926821264777208, 0.9970091057436191, 1.3083975200716722, 1.653398154279403, 1.8754489685904576, 1.947077976972141, 1.7119063683946025, 1.2212448977543244, 1.0103845450409459, 1.0297720379940232, 1.2428747315094615, 1.7533478847729131, 2.479872853340211, 2.9591543456710188];
h3_estimated = [0.1145552719064814, 0.11867858583135293, 0.13369547191126863, 0.1198910143765256, 0.07372710720441633, 0.020073194807898598, -0.024155271162470293, -0.00938676656621984, 0.024378989797997908, 0.04080850664325686, 0.0749176566224613, 0.10439982437398942, 0.12239509996081899, 0.13327484447774196, 0.1260918348835609, 0.0703391339642464, -0.07003819497868136, -0.2011731570503995, -0.22545932618162634, -0.16759647839035985, -0.07709644664421678, 0.02012857810237234, 0.09048628851583884, 0.13082928070439348, 0.1120392836734112, 0.012666023582187824, -0.11209282822415467, -0.14775197812382135, -0.0945722062032055, -0.04208298796539056];

h1_exact = [7.96, 7.928974937158787, 7.868129280531116, 7.717597393999766, 7.528624715683313, 7.213279244217083, 6.8027600501834655, 5.667929938089188, 4.716868843662674, 4.641018747397209, 3.817621276876608, 4.126907988674147, 5.315543967198879, 6.294710389518421, 7.037762261964792, 7.623815736906044, 7.9671682353317195, 7.898098806416474, 7.432687145550258, 7.468893952782617, 6.851740977510133, 7.258196211998655, 6.989007037364134, 7.203259313459162, 7.563627941108515, 7.465245279022634, 6.870050717263268, 6.096605825977445, 5.91001663169644, 4.977725439915396];
h2_exact = [0.9500000000000001, 0.9810250628412128, 1.0418707194688837, 1.192402606000234, 1.3813752843166864, 1.6967207557829167, 2.107239949816535, 3.242070061910813, 4.193131156337326, 4.268981252602791, 5.092378723123392, 4.783092011325853, 3.594456032801121, 2.6152896104815784, 1.872237738035208, 1.2861842630939557, 0.9428317646682808, 1.011901193583526, 1.4773128544497423, 1.4411060472173833, 2.058259022489867, 1.651803788001345, 1.9209929626358655, 1.7067406865408379, 1.3463720588914851, 1.4447547209773661, 2.0399492827367323, 2.813394174022555, 2.999983368303561, 3.932274560084604];
h3_exact = [0.1145552719064814, 0.11867858583135293, 0.1337686698965601, 0.11850699135531662, 0.06486371468514673, -0.006103202157041743, -0.06500126368353853, -0.0220268334583541, 0.013001859726174514, 0.031016785563363625, 0.07931932589487756, 0.10443418016804695, 0.12121362419535131, 0.13312683424119753, 0.12732609144145812, 0.08233508317394078, -0.03582760691357645, -0.14925389424531021, -0.11348134043392599, -0.17706933825608484, -0.021508656580258467, 0.011256500906791977, 0.10272241301508112, 0.13324794504078852, 0.11104760048380657, 0.0336407592423128, -0.016152036020045002, -0.026207180598900703, -0.05054243394721136, 0.013712896045537937];

h1_ = [7.96, 7.928974937158787, 7.868129280531116, 7.724884947608131, 7.490939726778092, 7.230496241584967, 6.72531358083781, 5.615766962139908, 5.1382878634608025, 4.621139283010106, 4.297615178023352, 5.110446640742894, 6.161229376161269, 6.971007314887444, 7.584184892362586, 7.9898791521296735, 8.16051234578284, 8.071832784637275, 7.625525818324803, 7.28286973609822, 6.965713619199972, 6.858736708423136, 7.083814944636519, 7.675161904670215, 7.985994700622543, 8.025601092190627, 7.902089867827105, 7.649540254077884, 6.918656264672232, 6.652636939978214];
h2_ = [0.9500000000000001, 0.9810250628412128, 1.0418707194688837, 1.1851150523918692, 1.419060273221908, 1.679503758415033, 2.1846864191621904, 3.294233037860092, 3.7717121365391977, 4.288860716989894, 4.612384821976648, 3.7995533592571062, 2.7487706238387313, 1.938992685112556, 1.325815107637414, 0.9201208478703263, 0.7494876542171608, 0.8381672153627249, 1.2844741816751968, 1.6271302639017793, 1.9442863808000277, 2.051263291576864, 1.8261850553634813, 1.2348380953297844, 0.9240052993774573, 0.8843989078093725, 1.0079101321728947, 1.2604597459221163, 1.9913437353277679, 2.257363060021786];
h3_ = [0.1145552719064814, 0.11867858583135293, 0.13271009438027803, 0.12624223068757812, 0.08979134522673149, 0.03427546191668718, 0.0019153575811744483, 0.03188754859715015, 0.0472075017309449, 0.07836530119036789, 0.10689464653972724, 0.12288059797847428, 0.13302039990620962, 0.12907633518177175, 0.09303270529458785, -0.007869086992316587, -0.21079922808715013, -0.4906382460466339, -0.4031948279410284, -0.34912896778032143, -0.18995372903695262, -0.053981213177130005, 0.04124549522792642, 0.1041787588290678, 0.13317848372961438, 0.0745597140219263, -0.03978196518582333, -0.13634256589477012, -0.062448228663016137, -0.02794390060485885];


hor = zeros(size(h1_estimated,2));

figure(1)
hold on
plot(h1_estimated,'r','LineWidth',2)
plot(h1_exact,'g','LineWidth',2)
plot(h1_,'b','LineWidth',2)
plot(hor,'k','LineWidth',2)
title('Min Distance Constraint')
legend('Estimated Dynamics','Exact Dynamics','Ignored Dynamics')

figure(2)
hold on
plot(h2_estimated,'r','LineWidth',2)
plot(h2_exact,'g','LineWidth',2)
plot(h2_,'b','LineWidth',2)
plot(hor,'k','LineWidth',2)
title('Max Distance Constraint')
legend('Estimated Dynamics','Exact Dynamics','Ignored Dynamics')

figure(3)
hold on
plot(h3_estimated,'r','LineWidth',2)
plot(h3_exact,'g','LineWidth',2)
plot(h3_,'b','LineWidth',2)
plot(hor,'k','LineWidth',2)
title('FoV angle Constraint')
legend('Estimated Dynamics','Exact Dynamics','Ignored Dynamics')

%% With QP

h1_cbf_estimated = [7.96, 7.867452435482232, 7.736096204785168, 7.4152042135651275, 7.096043699315495, 6.68190833591046, 6.456107074487672, 5.816061878257788, 5.8438627217941415, 5.946471889807519, 5.8892593362264725, 6.4224703898123625, 7.072417895492977, 7.195010231727898, 7.29767017036938, 7.49075164335994, 7.451613252646013, 7.337729968925288, 7.142647301213001, 6.994956230434113, 6.821287790321943, 6.688003973953682, 6.540423177503632, 6.340083376250121, 6.067752565406526, 5.564891552300461, 5.135903294297691, 4.764663115479099, 4.571359779140643, 4.357521466137821];
h1_cbf_ignored = [7.96, 7.867452435482232, 7.736096204785168, 7.4922349831401505, 7.132092462018105, 6.943032409213984, 6.60624239319106, 6.23141194064606, 6.374111312336493, 6.0694664791244275, 6.623436014134254, 7.121875545642144, 7.333779485189635, 7.559656341226393, 7.826606550453847, 8.027831016446548, 7.974744398021139, 7.851779823940659, 7.866547668310277, 7.725153860491474, 7.636689363146255, 7.592136917053281, 7.548382528318983, 7.701935015590482, 7.564531313294308, 7.239038731899408, 7.1207295395568355, 6.6099047999325276, 6.6106917875531614, 6.562608943737823];
h1_cbf_exact = [7.96, 7.867452235723172, 7.643741721298306, 7.446963556582806, 7.140408433137482, 6.943303111550456, 6.801688971289188, 6.039135057360549, 6.29525012389721, 6.129797943137916, 6.096273029681605, 6.864296098801034, 6.961816058656522, 6.911847274576819, 7.13705835542944, 7.4123462510905025, 7.329577227017571, 7.327384540222267, 7.3905555984215, 7.288202343314774, 6.629012927345792, 6.646628837287073, 6.722851506642733, 6.236340053018756, 5.657642294354274, 5.067828044473517, 4.902478320332835, 4.860204619595876, 4.436106209402911, 3.789051571882191];

h2_cbf_estimated = [0.9500000000000001, 1.0425475645177678, 1.1739037952148315, 1.4947957864348727, 1.8139563006845048, 2.22809166408954, 2.4538929255123283, 3.093938121742212, 3.0661372782058587, 2.963528110192481, 3.0207406637735277, 2.487529610187638, 1.8375821045070222, 1.714989768272102, 1.6123298296306199, 1.4192483566400602, 1.4583867473539873, 1.5722700310747124, 1.7673526987869987, 1.915043769565887, 2.0887122096780573, 2.221996026046318, 2.369576822496368, 2.56991662374988, 2.8422474345934745, 3.345108447699539, 3.7740967057023096, 4.145336884520901, 4.338640220859357, 4.552478533862179];
h2_cbf_ignored = [0.9500000000000001, 1.0425475645177678, 1.1739037952148315, 1.4177650168598492, 1.777907537981895, 1.9669675907860162, 2.30375760680894, 2.67858805935394, 2.5358886876635074, 2.840533520875572, 2.2865639858657465, 1.7881244543578558, 1.576220514810365, 1.350343658773607, 1.0833934495461528, 0.8821689835534516, 0.935255601978861, 1.0582201760593404, 1.0434523316897228, 1.184846139508526, 1.2733106368537452, 1.3178630829467184, 1.3616174716810165, 1.2080649844095177, 1.345468686705692, 1.670961268100592, 1.7892704604431642, 2.300095200067473, 2.299308212446839, 2.347391056262177];
h2_cbf_exact = [0.9500000000000001, 1.042547764276828, 1.2662582787016943, 1.4630364434171943, 1.7695915668625177, 1.9666968884495433, 2.1083110287108116, 2.870864942639451, 2.61474987610279, 2.780202056862084, 2.813726970318395, 2.0457039011989653, 1.9481839413434783, 1.998152725423181, 1.7729416445705595, 1.4976537489094977, 1.5804227729824285, 1.5826154597777327, 1.5194444015785005, 1.6217976566852261, 2.2809870726542085, 2.2633711627129274, 2.1871484933572676, 2.6736599469812443, 3.252357705645726, 3.842171955526483, 4.007521679667165, 4.049795380404124, 4.4738937905970895, 5.120948428117809];

h3_cbf_estimated = [0.1145552719064814, 0.11960876110729923, 0.13375354096960135, 0.1219061092073187, 0.09264341235611129, 0.05062409815706925, 0.011434966059039486, 0.010589437557628978, -0.005264893564054796, 0.002851874981108393, 0.047313412575530234, 0.07881716844067366, 0.10940674493157554, 0.13246904034174833, 0.1287647399367179, 0.107078434237175, 0.07451034913795729, 0.03112649812727375, 0.00502606113565629, -0.0006539696799129358, 0.02743590031644849, 0.07282585668740715, 0.1151387234105894, 0.13376835476365845, 0.1233707481598193, 0.10019252596452421, 0.08071882997898405, 0.06528800528604062, 0.0568894334443264, 0.06823256401639821];
h3_cbf_ignored = [0.1145552719064814, 0.11960876110729923, 0.13283756446228423, 0.12768939105248334, 0.10677718094579702, 0.07054365019022646, 0.05532983567365213, 0.05611335680333973, 0.0532060588426122, 0.07892578260191507, 0.09368755391090366, 0.11611234769278944, 0.13290422131723323, 0.12844986473211695, 0.10341881286161902, 0.037202021805433305, -0.03248542851342362, -0.09767884704025331, -0.21900527778633383, -0.24194720367286637, -0.19728829067605602, -0.07928835618748942, 0.047754817980362296, 0.11853350507771543, 0.1298850471639903, 0.104682208742785, 0.07182183455481905, 0.0658630200747623, 0.05898823349525828, 0.06845628075907362];
h3_cbf_exact = [0.1145552719064814, 0.12423133240959872, 0.13396109381515686, 0.11836975957051954, 0.0871392134278337, 0.03179004042253908, -0.021901409290950524, -0.007221994699355916, -0.04090379194165039, -0.008648756552020909, 0.04020195771605395, 0.06382262889974732, 0.11108001391678501, 0.13243239980036536, 0.13066090957565024, 0.11390383460046527, 0.0896304713360192, 0.05158949971239646, 0.008986929960761003, 2.587146288812736e-05, 0.05762497788547638, 0.08437963835086937, 0.11577791557887962, 0.13377164869609193, 0.12604097665160074, 0.10819273210461167, 0.08893138091901076, 0.06921000840201308, 0.06841924300832436, 0.08548523921950957];

h1_cbf_exact_05 = [7.96, 7.913022132569695, 7.8355881034214665, 7.768478144940769, 7.70204313505646, 7.628486635312421, 7.515355137669911, 7.4183754738255026, 7.334381816313564, 7.265667510015575, 7.111229225704239, 6.808179218828485, 6.565549927377367, 6.518264947229303, 6.556842981967947, 6.530888255224195, 6.282212346720074, 6.077385991673985, 6.086987376382831, 6.1420970849282925, 6.2925032293922065, 6.328543699633425, 6.356896618255401, 6.424215830718728, 6.4215091958400405, 6.512064612424673, 6.536992332217192, 6.618390600390388, 6.7326498221957145, 6.757825556971163, 6.823797351481442, 6.897202740128066, 6.946883679049703, 6.942342370133813, 6.863465866707509, 6.7058869458748855, 6.542805770562229, 6.385846083169085, 6.303054127747146, 6.3277828268065015, 6.359300267768694, 6.341975340932819, 6.221623849433778, 6.024593467240204, 5.828484674809641, 5.63822388560618, 5.483316714182805, 5.286662167445951, 5.060723471148295, 4.909043869751391, 4.816174917981776, 4.747451301292888, 4.66339439097631, 4.535748642518782, 4.364834093515159, 4.184602607271759, 3.8747457897038915, 3.6668506764659927, 3.622722216677757, 3.565744819821221];
h1_cbf_estimated_05 = [7.96, 7.913022132569694, 7.860026032323302, 7.794681749865956, 7.6996736115514866, 7.624148192688769, 7.503552112918381, 7.366559164403871, 7.218799298165769, 7.114532313283476, 6.924558826347699, 6.688813642748068, 6.517914231786153, 6.442328504793674, 6.392501898143237, 6.307116665131311, 6.106941578956217, 5.998631937760855, 6.037340243126077, 6.029970119223498, 6.096634619688363, 6.0807281739243875, 6.127477615825218, 6.255632772134035, 6.311298803008203, 6.44067663538981, 6.484135154379077, 6.570082757732377, 6.679452270010947, 6.6769232514487, 6.679081618020829, 6.676002291625451, 6.656626165608154, 6.614403356819373, 6.548720722731412, 6.463027055911784, 6.411263352793322, 6.339363500131249, 6.253111233929952, 6.180728371997235, 6.0991487468949925, 6.02574543925348, 5.944259010484627, 5.85019610496353, 5.757284598391333, 5.640322518075388, 5.510317657475081, 5.331603942040685, 5.111450853780848, 4.937171097853918, 4.747202978343005, 4.547416310520384, 4.349461895855534, 4.169092393376361, 4.024635841458107, 3.935249469021529, 3.7432251965703056, 3.6329767725343975, 3.6192308350532967, 3.516566052618707];

h2_cbf_exact_05 = [0.9500000000000001, 0.996977867430305, 1.0744118965785332, 1.1415218550592316, 1.2079568649435397, 1.2815133646875791, 1.3946448623300898, 1.4916245261744971, 1.575618183686436, 1.6443324899844252, 1.7987707742957604, 2.1018207811715155, 2.3444500726226334, 2.3917350527706973, 2.353157018032054, 2.3791117447758054, 2.6277876532799262, 2.8326140083260154, 2.8230126236171684, 2.7679029150717076, 2.6174967706077936, 2.581456300366576, 2.553103381744599, 2.4857841692812723, 2.4884908041599596, 2.3979353875753264, 2.373007667782808, 2.2916093996096127, 2.1773501778042856, 2.152174443028837, 2.0862026485185576, 2.0127972598719346, 1.963116320950297, 1.9676576298661865, 2.0465341332924907, 2.2041130541251146, 2.367194229437771, 2.5241539168309157, 2.606945872252855, 2.5822171731934986, 2.550699732231307, 2.5680246590671816, 2.688376150566223, 2.885406532759796, 3.08151532519036, 3.2717761143938193, 3.4266832858171954, 3.623337832554049, 3.849276528851705, 4.000956130248609, 4.093825082018224, 4.162548698707112, 4.24660560902369, 4.374251357481218, 4.545165906484841, 4.725397392728241, 5.035254210296109, 5.243149323534007, 5.287277783322243, 5.344255180178779];
h2_cbf_estimated_05 = [0.9500000000000001, 0.9969778674303066, 1.049973967676698, 1.115318250134044, 1.2103263884485134, 1.285851807311231, 1.4064478870816182, 1.5434408355961295, 1.6912007018342308, 1.795467686716524, 1.9854411736523014, 2.221186357251932, 2.392085768213847, 2.467671495206326, 2.5174981018567633, 2.6028833348686895, 2.803058421043783, 2.9113680622391453, 2.872659756873923, 2.880029880776502, 2.813365380311637, 2.8292718260756127, 2.782522384174782, 2.654367227865965, 2.5987011969917977, 2.4693233646101898, 2.425864845620923, 2.3399172422676235, 2.230547729989053, 2.2330767485513006, 2.230918381979171, 2.233997708374549, 2.2533738343918457, 2.295596643180627, 2.3612792772685878, 2.4469729440882158, 2.498736647206678, 2.570636499868751, 2.6568887660700478, 2.729271628002765, 2.8108512531050076, 2.8842545607465193, 2.965740989515373, 3.0598038950364708, 3.152715401608667, 3.2696774819246115, 3.3996823425249185, 3.5783960579593157, 3.7985491462191514, 3.972828902146082, 4.162797021656995, 4.362583689479616, 4.560538104144466, 4.740907606623639, 4.885364158541893, 4.974750530978471, 5.1667748034296945, 5.277023227465603, 5.2907691649467035, 5.393433947381293];

h3_cbf_exact_05 = [0.1145552719064814, 0.11983660323196355, 0.12741460967917118, 0.13292569555023714, 0.13339520238256308, 0.12673123239794193, 0.11518217647536899, 0.09893007459443859, 0.0760384213382459, 0.056852726441551815, 0.03961885571631274, 0.03183408783341446, 0.023557200781462062, 0.00782087231718731, -0.010100875770573392, -0.018251993123822863, -0.0015020195274246806, 0.017746298793366977, 0.031283958921663024, 0.04730855742018758, 0.06283301222492355, 0.08258609582935261, 0.10043994785305077, 0.11456632189232929, 0.12533047871062497, 0.1315812931454613, 0.13395300405273503, 0.13248177813845086, 0.12866508787878916, 0.12365910396457347, 0.11563678536299138, 0.10399551155100462, 0.08882028908106987, 0.07181239705786369, 0.056866362040667306, 0.048210985465628076, 0.044049892407046154, 0.04446253449848625, 0.047039010106067036, 0.05100140578095724, 0.060175322324720004, 0.07509948348386808, 0.09372193267667628, 0.11105033368711548, 0.12383554500952965, 0.13148745016559082, 0.13397459279422386, 0.13168237949710515, 0.12622674019088687, 0.12094265533383863, 0.11437359982393458, 0.10674406296370575, 0.09887908239068843, 0.09199383149355034, 0.08715698457167886, 0.08478766781098723, 0.08702258658691842, 0.09091052219020046, 0.09560729480500363, 0.10216147259041741];
h3_cbf_estimated_05 = [0.1145552719064814, 0.11721240129819066, 0.1238938287396375, 0.1315383301038553, 0.1338845100527618, 0.1287856569068211, 0.11756495346882534, 0.10283981730320557, 0.08338717201321, 0.06767103798166774, 0.05348225445880761, 0.04232456194963263, 0.030939711365594036, 0.017350476949598348, 0.005479200350670954, 0.0009735037399393187, 0.011415555452407578, 0.023520966478840277, 0.03477783186508043, 0.05211430602474121, 0.069112123223519, 0.08814836168691975, 0.10397912542741283, 0.11639453535189148, 0.12616198934328748, 0.13196643460711188, 0.13397456829670162, 0.13204334018596442, 0.12777314337939827, 0.12248958085726214, 0.11456644504240554, 0.1038830823399548, 0.09079485605115245, 0.07638081374587724, 0.0622962753084898, 0.05102346060273777, 0.04225187337242209, 0.039263859384582434, 0.04248865135816993, 0.05063812089650821, 0.06365698392771546, 0.0793281017609978, 0.09599472240052498, 0.11143030761102501, 0.12361104923130506, 0.13135578110764734, 0.13397445633960647, 0.1315978970710896, 0.12593778397384725, 0.12058587054740588, 0.11439655194193721, 0.10769098148323353, 0.10099583459989936, 0.09489267748309382, 0.08992914714181721, 0.08654346872983187, 0.08705599613032189, 0.08973476203993325, 0.09410426327139276, 0.10109065626822611];

hor = zeros(1,size(h1_cbf_estimated_05,2));

t = 0:0.1:(length(h1_cbf_estimated)*0.1-0.1);
t_05 = 0:0.05:(length(h1_cbf_estimated_05)*0.05-0.05);

figure(4)
hold on
plot(t,h1_cbf_estimated,'r','LineWidth',2)
plot(t,h1_cbf_exact,'g','LineWidth',2)
plot(t,h1_cbf_ignored,'b','LineWidth',2)
plot(t_05,h1_cbf_exact_05,'g--')
plot(t_05,h1_cbf_estimated_05,'r--')
plot(t_05,hor,'k','LineWidth',2)
title('Min Distance Constraint')
legend('Estimated Dynamics','Exact Dynamics','Ignored Dynamics')

figure(5)
hold on
plot(t,h2_cbf_estimated,'r','LineWidth',2)
plot(t,h2_cbf_exact,'g','LineWidth',2)
plot(t,h2_cbf_ignored,'b','LineWidth',2)
plot(t_05,h2_cbf_exact_05,'g--')
plot(t_05,h2_cbf_estimated_05,'r--')
plot(t_05,hor,'k','LineWidth',2)
title('Max Distance Constraint')
legend('Estimated Dynamics','Exact Dynamics','Ignored Dynamics')

figure(6)
hold on
plot(t,h3_cbf_estimated,'r','LineWidth',2)
plot(t,h3_cbf_exact,'g','LineWidth',2)
plot(t,h3_cbf_ignored,'b','LineWidth',2)
plot(t_05,h3_cbf_exact_05,'g--')
plot(t_05,h3_cbf_estimated_05,'r--')
plot(t_05,hor,'k','LineWidth',2)
legend('Estimated Dynamics','Exact Dynamics','Ignored Dynamics')
title('FoV angle Constraint')
